(function(m,r){typeof exports=="object"&&typeof module<"u"?r(exports):typeof define=="function"&&define.amd?define(["exports"],r):(m=typeof globalThis<"u"?globalThis:m||self,r(m.screenShot={}))})(this,function(m){"use strict";const r=(g,o={},l="")=>{const s=document.createElement(g);for(let d in o)s.setAttribute(d,o[d]);return s.innerHTML=l,s},A=(g,o)=>(document.getElementById(g)||document.getElementsByTagName("head")[0].prepend(r("STYLE",{type:"text/css"},o)),!0),D=function(g={}){let o,l,s,d,u,w;A("geocam-screenshot-button",`
  .geocam-screenshot-button {
       background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxZW0iIGhlaWdodD0iMWVtIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxwYXRoIGZpbGw9ImN1cnJlbnRDb2xvciIgZD0iTTQgNGgzbDItMmg2bDIgMmgzYTIgMiAwIDAgMSAyIDJ2MTJhMiAyIDAgMCAxLTIgMkg0YTIgMiAwIDAgMS0yLTJWNmEyIDIgMCAwIDEgMi0ybTggM2E1IDUgMCAwIDAtNSA1YTUgNSAwIDAgMCA1IDVhNSA1IDAgMCAwIDUtNWE1IDUgMCAwIDAtNS01bTAgMmEzIDMgMCAwIDEgMyAzYTMgMyAwIDAgMS0zIDNhMyAzIDAgMCAxLTMtM2EzIDMgMCAwIDEgMy0zIi8+PC9zdmc+');
    }
  .geocam-viewshot-button {
       background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxZW0iIGhlaWdodD0iMWVtIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxwYXRoIGZpbGw9ImN1cnJlbnRDb2xvciIgZD0iTTQgNWgzbDItMmg2bDIgMmgzYTIgMiAwIDAgMSAyIDJ2MTJhMiAyIDAgMCAxLTIgMkg0YTIgMiAwIDAgMS0yLTJWN2EyIDIgMCAwIDEgMi0ybTkuMDkgNC40NWwtMi4wNCAyLjczbDEuNTUgMi4wN2wtLjg3LjY2bC0yLjQ2LTMuMjdMNiAxNmgxMnoiLz48L3N2Zz4=');
    }
  `);const f=a=>{if(u){const n={action:"screenshot",payload:{img:a,url:document.location.href}};u.postMessage(n)}},y=function(a,n,t){return new Promise(i=>{const e=new Image;e.onload=function(){const c=document.createElement("canvas"),h=c.getContext("2d");c.width=Math.min(n,e.width),c.height=n*e.height/e.width,h.drawImage(e,0,0,c.width,c.height),c.toBlob(i,a.type,t)},e.src=URL.createObjectURL(a)})},v=async a=>{const n=o.renderer.domElement;n.style.filter="invert(1)";let t=await new Promise(e=>n.toBlob(e));w&&(t=await y(t,w,.9));const i=[new ClipboardItem({[t.type]:t})];await navigator.clipboard.write(i),f(t),n.style.removeProperty("filter")},C=async a=>{document.body.style.filter="invert(1)";const n=o.renderer.domElement,t=n.getBoundingClientRect(),i=d.container.getBoundingClientRect(),e={top:Math.min(t.top,i.top),left:Math.min(t.left,i.left),bottom:Math.max(t.bottom,i.bottom),right:Math.max(t.right,i.right)};e.width=e.right-e.left,e.height=e.bottom-e.top;const c=document.createElement("canvas");c.width=e.width,c.height=e.height;const h=c.getContext("2d"),T=await d.takeScreenshot(),I=new Image;I.src=T.dataUrl,await new Promise(p=>{I.onload=p}),t.witdh>i.width||t.height>i.height?(h.drawImage(n,t.left-e.left,t.top-e.top),h.drawImage(I,i.left-e.left,i.top-e.top)):(h.drawImage(I,i.left-e.left,i.top-e.top),h.drawImage(n,t.left-e.left,t.top-e.top));let M=await new Promise(p=>c.toBlob(p));w&&(M=await y(M,w,.9));const S=[new ClipboardItem({[M.type]:M})];await navigator.clipboard.write(S),f(M),document.body.style.removeProperty("filter")};this.init=function(a){o=a,l=r("DIV",{class:"geocam-screenshot-button geocam-viewer-control-button",title:"Copy a screenshot of the current viewer image to the clipboard"}),o.addControl(l,"left-top"),l.addEventListener("click",v,!1);const n=g.channel;n&&"BroadcastChannel"in window&&(u=new BroadcastChannel(n),console.log("broadcasting on channel",n)),w=parseInt(g.maxWidth)},this.arcgisView=function(a){console.log("screen shot add view",a),d||(d=a,s=r("DIV",{class:"geocam-viewshot-button geocam-viewer-control-button",title:"Copy a screenshot of the current viewer image and map to the clipboard"}),o.addControl(s,"left-top",{after:l}),s.addEventListener("click",C,!1))},this.destroy=function(){s&&o.wrapper.removeChild(s),o.wrapper.removeChild(l)}};class b extends HTMLElement{constructor(){super(),this.plugin=null,console.log("screen-shot init")}connectedCallback(){console.log("screen-shot connected");const o=this.parentNode;o.viewer&&o.viewer.plugin?(this.plugin=new D({channel:this.getAttribute("channel"),maxWidth:this.getAttribute("max-width")}),o.viewer.plugin(this.plugin)):console.error("GeocamViewerScreenShot must be a child of GeocamViewer")}disconnectedCallback(){this.plugin=null,console.log("screen-shot disconnected")}}window.customElements.define("geocam-viewer-screen-shot",b),m.GeocamViewerScreenShot=b,Object.defineProperty(m,Symbol.toStringTag,{value:"Module"})});
