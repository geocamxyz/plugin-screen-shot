(function(l,s){typeof exports=="object"&&typeof module<"u"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(l=typeof globalThis<"u"?globalThis:l||self,s(l.screenShot={}))})(this,function(l){"use strict";const s=(d,t={},r="")=>{const c=document.createElement(d);for(let g in t)c.setAttribute(g,t[g]);return c.innerHTML=r,c},f=(d,t)=>(document.getElementById(d)||document.getElementsByTagName("head")[0].prepend(s("STYLE",{type:"text/css"},t)),!0),y=function(d={}){let t,r,c,g,M;f("geocam-screenshot-button",`
  .geocam-screenshot-button {
       background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxZW0iIGhlaWdodD0iMWVtIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxwYXRoIGZpbGw9ImN1cnJlbnRDb2xvciIgZD0iTTQgNGgzbDItMmg2bDIgMmgzYTIgMiAwIDAgMSAyIDJ2MTJhMiAyIDAgMCAxLTIgMkg0YTIgMiAwIDAgMS0yLTJWNmEyIDIgMCAwIDEgMi0ybTggM2E1IDUgMCAwIDAtNSA1YTUgNSAwIDAgMCA1IDVhNSA1IDAgMCAwIDUtNWE1IDUgMCAwIDAtNS01bTAgMmEzIDMgMCAwIDEgMyAzYTMgMyAwIDAgMS0zIDNhMyAzIDAgMCAxLTMtM2EzIDMgMCAwIDEgMy0zIi8+PC9zdmc+');
    }
  .geocam-viewshot-button {
       background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxZW0iIGhlaWdodD0iMWVtIiB2aWV3Qm94PSIwIDAgMjQgMjQiPjxwYXRoIGZpbGw9ImN1cnJlbnRDb2xvciIgZD0iTTQgNWgzbDItMmg2bDIgMmgzYTIgMiAwIDAgMSAyIDJ2MTJhMiAyIDAgMCAxLTIgMkg0YTIgMiAwIDAgMS0yLTJWN2EyIDIgMCAwIDEgMi0ybTkuMDkgNC40NWwtMi4wNCAyLjczbDEuNTUgMi4wN2wtLjg3LjY2bC0yLjQ2LTMuMjdMNiAxNmgxMnoiLz48L3N2Zz4=');
    }
  `);const u=a=>{if(M){const n={action:"screenshot",payload:{img:a,url:document.location.href}};M.postMessage(n)}},A=async a=>{const n=t.renderer.domElement;n.style.filter="invert(1)";const o=await new Promise(e=>n.toBlob(e)),i=[new ClipboardItem({[o.type]:o})];await navigator.clipboard.write(i),u(o),n.style.removeProperty("filter")},D=async a=>{document.body.style.filter="invert(1)";const n=t.renderer.domElement,o=n.getBoundingClientRect(),i=g.container.getBoundingClientRect(),e={top:Math.min(o.top,i.top),left:Math.min(o.left,i.left),bottom:Math.max(o.bottom,i.bottom),right:Math.max(o.right,i.right)};e.width=e.right-e.left,e.height=e.bottom-e.top;const m=document.createElement("canvas");m.width=e.width,m.height=e.height;const h=m.getContext("2d"),v=await g.takeScreenshot(),w=new Image;w.src=v.dataUrl,await new Promise(p=>{w.onload=p}),o.witdh>i.width||o.height>i.height?(h.drawImage(n,o.left-e.left,o.top-e.top),h.drawImage(w,i.left-e.left,i.top-e.top)):(h.drawImage(w,i.left-e.left,i.top-e.top),h.drawImage(n,o.left-e.left,o.top-e.top));const I=await new Promise(p=>m.toBlob(p)),C=[new ClipboardItem({[I.type]:I})];await navigator.clipboard.write(C),u(I),document.body.style.removeProperty("filter")};this.init=function(a){t=a,r=s("DIV",{class:"geocam-screenshot-button geocam-viewer-control-button",title:"Copy a screenshot of the current viewer image to the clipboard"}),t.addControl(r,"left-top"),r.addEventListener("click",A,!1);const n=d.channel;n&&"BroadcastChannel"in window&&(M=new BroadcastChannel(n),console.log("broadcasting on channel",n))},this.arcgisView=function(a){console.log("screen shot add view",a),g||(g=a,c=s("DIV",{class:"geocam-viewshot-button geocam-viewer-control-button",title:"Copy a screenshot of the current viewer image and map to the clipboard"}),t.addControl(c,"left-top",{after:r}),c.addEventListener("click",D,!1))},this.destroy=function(){c&&t.wrapper.removeChild(c),t.wrapper.removeChild(r)}};class b extends HTMLElement{constructor(){super(),this.plugin=null,console.log("screen-shot init")}connectedCallback(){console.log("screen-shot connected");const t=this.parentNode;t.viewer&&t.viewer.plugin?(this.plugin=new y({channel:this.getAttribute("channel")}),t.viewer.plugin(this.plugin)):console.error("GeocamViewerScreenShot must be a child of GeocamViewer")}disconnectedCallback(){this.plugin=null,console.log("screen-shot disconnected")}}window.customElements.define("geocam-viewer-screen-shot",b),l.GeocamViewerScreenShot=b,Object.defineProperty(l,Symbol.toStringTag,{value:"Module"})});
